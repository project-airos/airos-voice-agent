nodes:
  # AI Script Generator (DYNAMIC - accepts topic input, generates script)
  - id: script-generator
    path: dynamic
    outputs:
      - script
      - complete
      - log
    inputs:
      topic: web-server/topic  # From WebSocket server
    env:
      LLM_PROVIDER: "${LLM_PROVIDER:-openai}"
      SCRIPT_DURATION: "${SCRIPT_DURATION:-5}"

  # WebSocket server for topic input (DYNAMIC)
  - id: web-server
    path: dynamic
    outputs:
      - topic
      - log
    inputs:
      script_complete: script-segmenter/script_complete
    env:
      PORT: 8123
      TOPIC_MODE: "true"  # Special mode to accept topic instead of audio

  # Script segmenter (DYNAMIC - processes the AI-generated script)
  - id: script-segmenter
    path: dynamic
    outputs:
      - daniu_text
      - yifan_text
      - script_complete
      - log
    inputs:
      script: script-generator/script  # From AI generator
      daniu_segment_complete: minimax-daniu/segment_complete
      yifan_segment_complete: minimax-yifan/segment_complete

  # MiniMax T2A TTS for 大牛 (Liu Xiang voice)
  - id: minimax-daniu
    build: pip install -e ../../nodes/dora-minimax-t2a
    path: dora-minimax-t2a
    inputs:
      text: script-segmenter/daniu_text
    outputs:
      - audio
      - segment_complete
      - log
    env:
      MINIMAX_API_KEY: "${MINIMAX_API_KEY}"
      MINIMAX_VOICE_ID: "moss_audio_9c223de9-7ce1-11f0-9b9f-463feaa3106a"
      MINIMAX_SPEED: "1.1"
      SAMPLE_RATE: "32000"
      BATCH_DURATION_MS: "2000"
      TEXT_LANG: "zh"
      LOG_LEVEL: "INFO"

  # MiniMax T2A TTS for 一帆 (Doubao voice)
  - id: minimax-yifan
    build: pip install -e ../../nodes/dora-minimax-t2a
    path: dora-minimax-t2a
    inputs:
      text: script-segmenter/yifan_text
    outputs:
      - audio
      - segment_complete
      - log
    env:
      MINIMAX_API_KEY: "${MINIMAX_API_KEY}"
      MINIMAX_VOICE_ID: "moss_audio_aaa1346a-7ce7-11f0-8e61-2e6e3c7ee85d"
      MINIMAX_SPEED: "1.0"
      SAMPLE_RATE: "32000"
      BATCH_DURATION_MS: "2000"
      TEXT_LANG: "zh"
      LOG_LEVEL: "INFO"

  # Voice output (DYNAMIC - concatenates audio with silence)
  - id: voice-output
    path: dynamic
    outputs:
      - log
    inputs:
      daniu_audio:
        source: minimax-daniu/audio
        queue_size: 1000
      yifan_audio:
        source: minimax-yifan/audio
        queue_size: 1000
      daniu_segment_complete: minimax-daniu/segment_complete
      yifan_segment_complete: minimax-yifan/segment_complete
      script_complete: script-segmenter/script_complete

  # Viewer (DYNAMIC - optional monitoring)
  - id: viewer
    path: dynamic
    inputs:
      generator_log: script-generator/log
      web_log: web-server/log
      segmenter_log: script-segmenter/log
      daniu_log: minimax-daniu/log
      yifan_log: minimax-yifan/log
      output_log: voice-output/log
      daniu_text: script-segmenter/daniu_text
      yifan_text: script-segmenter/yifan_text
      script_complete: script-segmenter/script_complete
